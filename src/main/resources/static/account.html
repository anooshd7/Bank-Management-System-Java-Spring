<!DOCTYPE html>
<html>

<head>
    <title>Account Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="flex flex-col w-full h-full justify-center text-center items-center bg-white">
    <div class="font-bold text-3xl mb-8">Account Management</div>

    <div class="border-b-2 border-black w-full mb-8"></div>

    <div class="flex flex-col w-full items-center justify-center mb-8">
        <div class="font-semibold text-xl">Deposit</div>
        <form id="depositForm" class="gap-2 flex flex-col items-center mb-4 p-4 border rounded bg-white">
            <div class="flex gap-2">
                <label for="depositAmount">Amount:</label>
                <input type="number" id="depositAmount" name="depositAmount" required
                    class="border rounded-md py-2 px-3">
            </div>
            <button type="submit"
                class="bg-blue-500 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:shadow-outline">
                Deposit
            </button>
        </form>
    </div>

    <div class="border-b-2 border-black w-full mb-8"></div>

    <div class="flex flex-col w-full items-center justify-center mb-8">
        <div class="font-semibold text-xl">Withdraw</div>
        <form id="withdrawForm" class="gap-2 flex flex-col items-center mb-4 p-4 border rounded bg-white">
            <div class="flex gap-2">
                <label for="withdrawAmount">Amount:</label>
                <input type="number" id="withdrawAmount" name="withdrawAmount" required
                    class="border rounded-md py-2 px-3">
            </div>
            <button type="submit"
                class="bg-blue-500 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:shadow-outline">
                Withdraw
            </button>
        </form>
    </div>

    <div class="border-b-2 border-black w-full mb-8"></div>

    <div class="flex flex-col w-full items-center justify-center mb-8">
        <div class="font-semibold text-xl">Check Balance</div>
        <form id="getBalanceForm" class="gap-2 flex flex-col items-center mb-4 p-4 border rounded bg-white">
            <button type="submit"
                class="bg-blue-500 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:shadow-outline">
                Check Balance
            </button>
        </form>
    </div>

    <div class="border-b-2 border-black w-full mb-8"></div>

    <div class="flex flex-col w-full items-center justify-center mb-8">
        <div class="font-semibold text-xl">Change PIN</div>
        <form id="changePINform" class="gap-2 flex flex-col items-center mb-4 p-4 border rounded bg-white">
            <div class="flex gap-2">
                <label for="newPIN">Enter New PIN:</label>
                <input type="text" id="newPIN" name="newPIN" required class="border rounded-md py-2 px-3">
            </div>
            <button type="submit"
                class="bg-blue-500 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:shadow-outline">
                Change PIN
            </button>
        </form>
    </div>

    <div class="border-b-2 border-black w-full mb-8"></div>
    <div class="font-semibold text-xl">Get Account Details</div>
    <form id="getAccountDetailsForm" class="flex flex-col items-center mb-4">
        <button type="submit" class="bg-blue-500 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-700 focus:outline-none focus:shadow-outline">
            Get Account Details
        </button>
    </form>
    <div id="accountDetails"></div>
    

    <script>

        document.getElementById("depositForm").addEventListener("submit", function (event) {
            event.preventDefault();
            let formData = new FormData(this);
            let depositAmount = parseFloat(formData.get("depositAmount"));
            if (isNaN(depositAmount) || depositAmount <= 0) {
                alert("Please enter a valid deposit amount.");
                return;
            }
            let username = localStorage.getItem("username");
            if (!username) {
                alert("Username not found in local storage.");
                return;
            }
            fetch(`/api/accounts/${username}/deposit`, {
                method: "POST",
                body: JSON.stringify({ amount : depositAmount }),
                headers: {
                    "Content-Type": "application/json"
                }
            })
            .then(response => response.json())
            .then(data => {
                alert("Deposit successful. New balance: " + data.balance);
                this.reset();
            })
            .catch(error => {
                alert("Failed to deposit: " + error.message);
            });
        });
        
        document.getElementById("withdrawForm").addEventListener("submit", function (event) {
            event.preventDefault();
            let formData = new FormData(this);
            let withdrawAmount = parseFloat(formData.get("withdrawAmount"));
            if (isNaN(withdrawAmount) || withdrawAmount <= 0) {
                alert("Please enter a valid withdrawal amount.");
                return;
            }
            let username = localStorage.getItem("username");
            if (!username) {
                alert("Username not found in local storage.");
                return;
            }
            fetch(`/api/accounts/${username}/withdraw`, {
                method: "POST",
                body: JSON.stringify({ amount: withdrawAmount }),
                headers: {
                    "Content-Type": "application/json"
                }
            })
            .then(response => response.json())
            .then(data => {
                alert("Withdrawal successful. New balance: " + data.balance);
                this.reset();
            })
            .catch(error => {
                alert("Failed to withdraw: " + error.message);
            });
        });        
        
        document.getElementById("getBalanceForm").addEventListener("submit", function (event) {
            event.preventDefault();
            let username = localStorage.getItem("username");
            if (!username) {
                alert("Username not found in local storage.");
                return;
            }
            fetch(`/api/accounts/${username}/balance`, {
                method: "GET",
                headers: {
                    "Content-Type": "application/json"
                }
            })
            .then(response => response.json())
            .then(data => {
                alert("Current balance: " + data);
                this.reset();
            })
            .catch(error => {
                alert("Failed to fetch balance: " + error.message);
            });
        });
        
        document.getElementById("getAccountDetailsForm").addEventListener("submit", function (event) {
            event.preventDefault();
            let username = localStorage.getItem("username");
            if (!username) {
                alert("Username not found in local storage.");
                return;
            }
            fetch(`/api/accounts/${username}/details`, {
                method: "GET",
                headers: {
                    "Content-Type": "application/json"
                }
            })
            .then(response => response.json())
            .then(data => {
                let detailsDiv = document.getElementById("accountDetails");
                detailsDiv.innerHTML = `
                    <p><strong>Account ID:</strong> ${data.id}</p>
                    <p><strong>Name:</strong> ${data.accountHolderName}</p>
                    <p><strong>Balance:</strong> ${data.balance}</p>
                    <p><strong>Interest Rate:</strong> ${data.interestRate ? data.interestRate : 'Not Applicable'}</p>
                `;
                this.reset();
            })
            .catch(error => {
                alert("Failed to fetch account details: " + error.message);
            });
        });
        
        document.getElementById("changePINform").addEventListener("submit", function (event) {
            event.preventDefault();
            let formData = new FormData(this);
            let newPIN = formData.get("newPIN");
            let username = localStorage.getItem("username");
            if (!username) {
                alert("Username not found in local storage.");
                return;}
            fetch(`/api/accounts/${username}/changePIN`, {
                method: "POST",
                body: JSON.stringify({
                    newPIN: newPIN
                }),
                headers: {
                    "Content-Type": "application/json"
                }
            })
            .then(response => {
                if (response.ok) {
                    alert("PIN changed successfully");
                    document.getElementById("changePINform").reset();
                } else {
                    throw new Error("Failed to change PIN");
                }
            })
            .catch(error => {
                alert("Failed to change PIN: " + error.message);
            });
        });        
               
    </script>
</body>

</html>
