<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="./style.css">
    <title>Document</title>
</head>
<body>
    <div class="ATM">
        <p class="welcome-text">MAXIMUM WITHDRAWAL AMOUNT IS INR 10,000</p>
        <p class="amount-text">PLEASE ENTER YOUR AMOUNT</p>
        <form id="withdrawForm">
        <input name="amount" id="amount" type="number" max="10000" min="100"/>
        <button type="submit">WITHDRAW</button>
        </form>
        <button class="back" onclick="window.location.href='atm.html'">BACK</button>
    </div>
</body>

<script>
    document.getElementById("withdrawForm").addEventListener("submit", function (event) {
        event.preventDefault();
        let username = localStorage.getItem("username");
        let atm = localStorage.getItem("atm");
        if (!username) {
            alert("Username not found in local storage.");
        }
        let formData = new FormData(this);
        let amount = parseFloat(formData.get("amount"));
        if (amount < 100) {
            alert("Minimum withdraw amount is INR 100.");
            return;
        }
        fetch(`/api/atm/${username}/withdraw?atm=${atm}`, {
            method: 'POST',
            body: JSON.stringify({ amount: amount }),
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(response => {
            return response.json();
        }).then(data => {
            alert("Deposit successful. New balance: " + data.balance);
        });
    });
    
</script>
</html>